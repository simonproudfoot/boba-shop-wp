{"version":3,"sources":["product-card.js"],"names":["Vue","component","props","url","type","String","default","handopenimg","handclosingimg","scytheimg","image","category","price","Number","index","title","stockLevel","sold_out","Boolean","productId","required","colorVariations","Array","data","chosenCount","isAddingToCart","addToCartSuccess","addToCartError","computed","random","hasVariants","isArray","length","allVariantsOutOfStock","every","v","stock","effectiveStockLevel","reduce","sum","parseInt","isOutOfStock","cardDisabledClass","imageSrc","isLarge","thumb_2200","thumb_1280","full","imageSrcset","srcset","push","join","imageSizes","cartUrl","window","location","origin","mounted","console","log","$props","methods","addToCart","cartData","product_id","response","$root","success","updateQuantity","finishCartOperation","error","previousResponse","updateData","quantity","updateCartQuantity","cartCount","calculateCartQuantity","cartQuantity","jQuery","text","setTimeout","Object","values","num","isNaN","buyNow","href","template"],"mappings":"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","file":"product-card.min.js","sourcesContent":["Vue.component(\"productcard\", {\n    props: {\n        url: {\n            type: String,\n            default: ''\n        },\n        handopenimg: {\n            type: String,\n            default: ''\n        },\n        handclosingimg: {\n            type: String,\n            default: ''\n        },\n        scytheimg: {\n            type: String,\n            default: ''\n        },\n        image: {\n            type: String,\n            default: ''\n        },\n        category: {\n            type: String,\n            default: ''\n        },\n        price: {\n            type: Number,\n            default: 0\n        },\n        index: {\n            type: Number,\n            default: 0\n        },\n        title: {\n            type: String,\n            default: ''\n        },\n        stockLevel: {\n            type: Number,\n            default: 0\n        },\n        sold_out: {\n            type: Boolean,\n            default: false\n        },\n        productId: {\n            type: Number,\n            required: true\n        },\n        colorVariations: {\n            type: Array,\n            default: []\n        }\n    },\n    data() {\n        return {\n            chosenCount: 1,\n            isAddingToCart: false,\n            addToCartSuccess: false,\n            addToCartError: ''\n        };\n    },\n    computed: {\n        random() {\n            return this.index % 2 === 0\n        },\n        hasVariants() {\n            // If the product has multiple variants (e.g. from colorVariations prop)\n            return Array.isArray(this.colorVariations) && this.colorVariations.length > 0;\n        },\n        allVariantsOutOfStock() {\n            // True if all variants are out of stock\n            return this.hasVariants && this.colorVariations.every(v => !v.stock || v.stock <= 0);\n        },\n        effectiveStockLevel() {\n            if (this.hasVariants) {\n                // Find the sum of all variant stocks, but only if at least one is in stock\n                if (this.allVariantsOutOfStock) return 0;\n                return this.colorVariations.reduce((sum, v) => sum + (parseInt(v.stock, 10) > 0 ? parseInt(v.stock, 10) : 0), 0);\n            }\n            return this.sold_out ? 0 : this.stockLevel;\n        },\n        isOutOfStock() {\n            if (this.hasVariants) {\n                return this.allVariantsOutOfStock;\n            }\n            return this.sold_out || this.stockLevel <= 0;\n        },\n        cardDisabledClass() {\n            return this.effectiveStockLevel > 0 ? '' : 'opacity-30 pointer-events-none';\n        },\n        imageSrc() {\n            if (typeof this.image === 'string') {\n                return this.image || '';\n            }\n            if (this.image && typeof this.image === 'object') {\n                if (this.isLarge && this.image.thumb_2200) {\n                    return this.image.thumb_2200;\n                }\n                if (this.image.thumb_1280) {\n                    return this.image.thumb_1280;\n                }\n                if (this.image.full) {\n                    return this.image.full;\n                }\n            }\n            return '';\n        },\n        imageSrcset() {\n            if (typeof this.image === 'string') {\n                return null;\n            }\n            if (this.image && typeof this.image === 'object') {\n                const srcset = [];\n                if (this.image.thumb_1280) {\n                    srcset.push(`${this.image.thumb_1280} 1280w`);\n                }\n                if (this.image.thumb_2200 && this.image.thumb_2200 !== this.image.thumb_1280) {\n                    srcset.push(`${this.image.thumb_2200} 2200w`);\n                }\n                if (this.image.full && this.image.full !== this.image.thumb_1280 && this.image.full !== this.image.thumb_2200) {\n                    srcset.push(`${this.image.full} 1920w`);\n                }\n                return srcset.length ? srcset.join(', ') : null;\n            }\n            return null;\n        },\n        imageSizes() {\n            return '(max-width: 1280px) 1280px, 2200px';\n        },\n        cartUrl() {\n            return window.location.origin + '/?checkout=1';\n        }\n    },\n    mounted() {\n        // Debug log for troubleshooting\n        console.log('[productcard] PROPS:', this.$props);\n        console.log('[productcard] sold_out:', this.sold_out, 'stockLevel:', this.stockLevel, 'hasVariants:', this.hasVariants, 'effectiveStockLevel:', this.effectiveStockLevel);\n    },\n    methods: {\n        async addToCart() {\n            console.log('[productcard] addToCart effectiveStockLevel:', this.effectiveStockLevel);\n            if (this.isAddingToCart || this.effectiveStockLevel <= 0) {\n                return;\n            }\n\n            this.isAddingToCart = true;\n            this.addToCartSuccess = false;\n            this.addToCartError = '';\n\n            let cartData = {\n                product_id: this.productId\n            };\n\n            try {\n                const response = await this.$root.addToCart(cartData);\n                if (response.success) {\n                    if (this.chosenCount > 1) {\n                        await this.updateQuantity(response);\n                    } else {\n                        this.finishCartOperation(response);\n                    }\n                } else {\n                    this.isAddingToCart = false;\n                    this.addToCartError = 'Failed to add to cart.';\n                }\n            } catch (error) {\n                this.isAddingToCart = false;\n                this.addToCartError = 'An error occurred: ' + error;\n            }\n        },\n        async updateQuantity(previousResponse) {\n            let updateData = {\n                product_id: this.productId,\n                quantity: this.chosenCount\n            };\n            try {\n                const response = await this.$root.updateCartQuantity(updateData);\n                if (response.success) {\n                    this.finishCartOperation(response);\n                } else {\n                    this.finishCartOperation(previousResponse);\n                }\n            } catch (error) {\n                this.finishCartOperation(previousResponse);\n            }\n        },\n        finishCartOperation(response) {\n            this.isAddingToCart = false;\n            this.addToCartSuccess = true;\n\n            // Calculate total cart count\n            const cartCount = this.calculateCartQuantity(response.data);\n\n            // Update global cart count for Vue to access\n            window.cartCount = cartCount;\n\n            // Update root Vue instance cartQuantity\n            if (this.$root && typeof this.$root.cartQuantity !== 'undefined') {\n                this.$root.cartQuantity = cartCount;\n            }\n\n            // Update cart count in menu\n            jQuery('.menu-item a:contains(\"Cart\")').text('🛒 Cart (' + cartCount + ')');\n\n            // Reset success message after delay\n            setTimeout(() => {\n                this.addToCartSuccess = false;\n            }, 3000);\n        },\n        calculateCartQuantity(cartData) {\n            if (!cartData) return 0;\n            return Object.values(cartData).reduce((sum, quantity) => {\n                const num = parseInt(quantity, 10);\n                return sum + (isNaN(num) ? 0 : num);\n            }, 0);\n        },\n        buyNow() {\n            // First add to cart\n            if (this.isAddingToCart || this.effectiveStockLevel <= 0) {\n                return;\n            }\n\n            this.addToCart();\n\n            // Then redirect to checkout\n            setTimeout(() => {\n                if (this.addToCartSuccess) {\n                    window.location.href = this.cartUrl;\n                }\n            }, 800); // Slightly longer delay to ensure cart is updated\n        }\n    },\n    template: `\n        <div class=\" font-body rounded-sm relative\">\n          \n            <div class=\"flex flex-col gap-y-1 [&>*]:w-full group\">\n                <a :href=\"url\">\n                <div class=\" mb-2 relative aspect-square\">\n                  \n                 <img class=\"group-hover:scale-105 text-transparent duration-200 bg-yellowDark group-hover:rotate-1 rounded-xl overflow-hidden w-full h-full object-cover object-center z-40   relative\" :src=\"image\" :alt=\"title\" /> \n                </a>\n                <h4 v-if=\"category\" class=\"text-xs font-light text-pink-400 hidden md:block\" v-html=\"category\"></h4>\n                <h3 class=\"md:text-3xl text-balance leading-[19px] md:leading-6 dynapuff-700 uppercase group-hover:text-pink duration-200\" v-html=\"title\"></h3>\n                <span v-if=\"price\">£{{ price.toFixed(2) }}</span>\n       \n                <span class=\"text-xs font-light text-red-600\" v-if=\"isOutOfStock\">Out of stock</span>\n                <!-- Status messages -->\n                <div v-if=\"addToCartSuccess\" class=\"text-green-600 text-sm mt-1\">Added to cart!</div>\n                <div v-if=\"addToCartError\" class=\"text-red-600 text-sm mt-1\">{{ addToCartError }}</div>\n             \n               \n            </div>\n        </div>\n    `\n});"]}