Vue.component("productcard",{props:{url:{type:String,default:""},handopenimg:{type:String,default:""},handclosingimg:{type:String,default:""},scytheimg:{type:String,default:""},image:{type:String,default:""},category:{type:String,default:""},price:{type:Number,default:0},index:{type:Number,default:0},title:{type:String,default:""},stockLevel:{type:Number,default:0},sold_out:{type:Boolean,default:!1},productId:{type:Number,required:!0},colorVariations:{type:Array,default:[]}},data:()=>({chosenCount:1,isAddingToCart:!1,addToCartSuccess:!1,addToCartError:""}),computed:{random(){return this.index%2==0},hasVariants(){return Array.isArray(this.colorVariations)&&this.colorVariations.length>0},allVariantsOutOfStock(){return this.hasVariants&&this.colorVariations.every(t=>!t.stock||t.stock<=0)},effectiveStockLevel(){return this.hasVariants?this.allVariantsOutOfStock?0:this.colorVariations.reduce((t,e)=>t+(parseInt(e.stock,10)>0?parseInt(e.stock,10):0),0):this.sold_out?0:this.stockLevel},isOutOfStock(){return this.hasVariants?this.allVariantsOutOfStock:this.sold_out||this.stockLevel<=0},cardDisabledClass(){return this.effectiveStockLevel>0?"":"opacity-30 pointer-events-none"},imageSrc(){if("string"==typeof this.image)return this.image||"";if(this.image&&"object"==typeof this.image){if(this.isLarge&&this.image.thumb_2200)return this.image.thumb_2200;if(this.image.thumb_1280)return this.image.thumb_1280;if(this.image.full)return this.image.full}return""},imageSrcset(){if("string"==typeof this.image)return null;if(this.image&&"object"==typeof this.image){const t=[];return this.image.thumb_1280&&t.push(this.image.thumb_1280+" 1280w"),this.image.thumb_2200&&this.image.thumb_2200!==this.image.thumb_1280&&t.push(this.image.thumb_2200+" 2200w"),this.image.full&&this.image.full!==this.image.thumb_1280&&this.image.full!==this.image.thumb_2200&&t.push(this.image.full+" 1920w"),t.length?t.join(", "):null}return null},imageSizes:()=>"(max-width: 1280px) 1280px, 2200px",cartUrl:()=>window.location.origin+"/?checkout=1"},mounted(){console.log("[productcard] PROPS:",this.$props),console.log("[productcard] sold_out:",this.sold_out,"stockLevel:",this.stockLevel,"hasVariants:",this.hasVariants,"effectiveStockLevel:",this.effectiveStockLevel)},methods:{async addToCart(){if(console.log("[productcard] addToCart effectiveStockLevel:",this.effectiveStockLevel),this.isAddingToCart||this.effectiveStockLevel<=0)return;this.isAddingToCart=!0,this.addToCartSuccess=!1,this.addToCartError="";let t={product_id:this.productId};try{const e=await this.$root.addToCart(t);e.success?this.chosenCount>1?await this.updateQuantity(e):this.finishCartOperation(e):(this.isAddingToCart=!1,this.addToCartError="Failed to add to cart.")}catch(t){this.isAddingToCart=!1,this.addToCartError="An error occurred: "+t}},async updateQuantity(t){let e={product_id:this.productId,quantity:this.chosenCount};try{const i=await this.$root.updateCartQuantity(e);i.success?this.finishCartOperation(i):this.finishCartOperation(t)}catch(e){this.finishCartOperation(t)}},finishCartOperation(t){this.isAddingToCart=!1,this.addToCartSuccess=!0;const e=this.calculateCartQuantity(t.data);window.cartCount=e,this.$root&&void 0!==this.$root.cartQuantity&&(this.$root.cartQuantity=e),jQuery('.menu-item a:contains("Cart")').text("ðŸ›’ Cart ("+e+")"),setTimeout(()=>{this.addToCartSuccess=!1},3e3)},calculateCartQuantity:t=>t?Object.values(t).reduce((t,e)=>{const i=parseInt(e,10);return t+(isNaN(i)?0:i)},0):0,buyNow(){this.isAddingToCart||this.effectiveStockLevel<=0||(this.addToCart(),setTimeout(()=>{this.addToCartSuccess&&(window.location.href=this.cartUrl)},800))}},template:'\n        <div class=" font-body rounded-sm relative">\n          \n            <div class="flex flex-col gap-y-1 [&>*]:w-full group">\n                <a :href="url">\n                <div class=" mb-2 relative aspect-square">\n                  \n                 <img class="group-hover:scale-105 text-transparent duration-200 bg-yellowDark group-hover:rotate-1 rounded-xl overflow-hidden w-full h-full object-cover object-center z-40   relative" :src="image" :alt="title" /> \n                </a>\n                <h4 v-if="category" class="text-xs font-light text-pink-400 hidden md:block" v-html="category"></h4>\n                <h3 class="md:text-3xl text-balance leading-[19px] md:leading-6 dynapuff-700 uppercase group-hover:text-pink duration-200" v-html="title"></h3>\n                <span v-if="price">Â£{{ price.toFixed(2) }}</span>\n       \n                <span class="text-xs font-light text-red-600" v-if="isOutOfStock">Out of stock</span>\n                \x3c!-- Status messages --\x3e\n                <div v-if="addToCartSuccess" class="text-green-600 text-sm mt-1">Added to cart!</div>\n                <div v-if="addToCartError" class="text-red-600 text-sm mt-1">{{ addToCartError }}</div>\n             \n               \n            </div>\n        </div>\n    '});